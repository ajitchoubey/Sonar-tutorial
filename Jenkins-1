node {
  environment{
    MSBUILD_SQ_SCANNER_HOME_1 = tool name: 'MSBuild', type: 'hudson.plugins.sonar.MsBuildSQRunnerInstallation'
    DotnetProjectName='ConsoleApp4'
  }
  stage ('Clean workspace') {
    cleanWs()
}
  stage ('Build + SonarQube analysis'){
        def MSBUILD_SQ_SCANNER_HOME = tool 'SonarScanner_For_MSBuild'
        withSonarQubeEnv('SonarServer') {
          bat "${MSBUILD_SQ_SCANNER_HOME}\\Sonar.Scanner.MSBuild.exe begin /k:myKey"
          bat  "MSBuild.exe ${DotnetProjectName} /t:Rebuild"
          bat "${MSBUILD_SQ_SCANNER_HOME}\\SonarQube.Scanner.MSBuild.exe end"
        }
     }
}


